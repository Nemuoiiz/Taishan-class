<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!--ğŸ”»è£½ä½œé€²éšå¾…è¾¦æ¸…å–®ï¼Œå¿…é ˆè¦æœ‰ä¸‹åˆ—åŠŸèƒ½ï¼š
        01. æ–°å¢åŠŸèƒ½ï¼Œå…©å€‹å­—ä»¥ä¸Šæ‰èƒ½æ–°å¢
        02. å°æ–¼å…©å€‹å­—æ™‚è¼¸å…¥æ¬„ä½é‚Šæ¡†æ˜¯ç´…è‰²ï¼ŒæˆåŠŸæ™‚æ˜¯è—è‰²ï¼Œç©ºç™½æ™‚æ˜¯é»‘è‰²
        03. æ¯å€‹é …ç›®æœ‰ checkbox å¯ä»¥æ‰“å‹¾æ¨™è¨˜å·²å®Œæˆæˆ–æœªå®Œæˆï¼Œå®Œæˆçš„é …ç›®æ–‡å­—å¿…é ˆè¦æœ‰åˆªé™¤ç·š
        04. å¯ä»¥å€‹åˆ¥åˆªé™¤æ¸…å–®é …ç›®
        05.å¯ä»¥å°‡æ¸…å–®è³‡æ–™ä¿å­˜åˆ° localStorage
        06.å¯ä»¥é»å…©ä¸‹æ¸…å–®é …ç›®é–‹å•Ÿç·¨è¼¯æ¬„ä½
        07.åœ¨ç·¨è¼¯æ¬„ä½æŒ‰ ENTER å¯ä»¥å„²å­˜ç·¨è¼¯
        08.åœ¨ç·¨è¼¯æ¬„ä½å¯ä»¥æŒ‰ ESC éµå¯ä»¥å–æ¶ˆç·¨è¼¯
        09.å¯ä»¥é»æŒ‰éˆ•éæ¿¾é¡¯ç¤ºå…¨éƒ¨é …ç›®ã€å·²å®Œæˆé …ç›®ã€æœªå®Œæˆé …ç›®
        10.å¯ä»¥é¡¯ç¤ºç›®å‰éæ¿¾çš„æ–¹å¼åŠéæ¿¾å¾Œçš„é …ç›®ç¸½æ•¸
        11.å¯ä»¥é»æŒ‰éˆ•ä¸€æ¬¡åˆªé™¤å…¨éƒ¨é …ç›®ã€å·²å®Œæˆé …ç›®ã€æœªå®Œæˆé …ç›®
        12.å¯ä»¥é»æŒ‰éˆ•å°‡æ‰€æœ‰é …ç›®æ¨™è¨˜ç‚ºå·²å®Œæˆ
        13.å¯ä»¥é»æŒ‰éˆ•å°‡æ‰€æœ‰é …ç›®æ¨™è¨˜ç‚ºæœªå®Œæˆ
        14.è«‹ä½¿ç”¨ Composition API

        ğŸ’¡ æç¤ºï¼š
        é»å…©ä¸‹çš„äº‹ä»¶ç‚º @dblclick
        æŒ‰ ESC éµçš„ï¼Œäº‹ä»¶ç‚º @keydown.esc
        éæ¿¾å¯ä»¥ä½¿ç”¨ computed æ­é… .filter()
    -->
</head>

<body>
    <div id="app">
        <form @submit.prevent="addItem">
            <!-- v-model ç¶å®šè¼¸å…¥æ¡† -->
            <input type="text" v-model="input" :style="{ border: inputBorder }">
            <input type="submit" value="æ–°å¢">
        </form>

        <hr>

        <input type="button" value="å…¨éƒ¨å·²å®Œæˆ" @click="markItems(true)">
        <input type="button" value="å…¨éƒ¨æœªå®Œæˆ" @click="markItems(false)">
        <br>
        <input type="button" value="é¡¯ç¤ºå…¨éƒ¨" @click="filter = 'å…¨éƒ¨'">
        <input type="button" value="é¡¯ç¤ºå·²å®Œæˆ" @click="filter = 'å·²å®Œæˆ'">
        <input type="button" value="é¡¯ç¤ºæœªå®Œæˆ" @click="filter = 'æœªå®Œæˆ'">
        <br>
        <input type="button" value="æ¸…é™¤å…¨éƒ¨" @click="clearItems('å…¨éƒ¨')">
        <input type="button" value="æ¸…é™¤å·²å®Œæˆ" @click="clearItems('å·²å®Œæˆ')">
        <input type="button" value="æ¸…é™¤æœªå®Œæˆ" @click="clearItems('æœªå®Œæˆ')">

        <hr>

        <p>ç›®å‰é¡¯ç¤ºï¼š{{ filter }}ï¼Œå…± {{ filteredItems.length }} å€‹</p>

        <ul>
            <!--ğŸ”» :key="item.id" ç‚ºæ¯å€‹é …ç›®æä¾›å”¯ä¸€çš„ id ä½œç‚ºæ¨™è­˜
                ä½¿éæ¿¾å‰éæ¿¾å¾Œçš„ item id ä¸è®ŠåŒ– -->
            <li v-for="item in filteredItems" :key="item.id">
                <input type="button" value="x" @click="delItem(item.id)">ã€€
                <input type="checkbox" v-model="item.done">
                <input type="text" v-if="item.edit" v-model="item.input" @keydown.enter="editItem(item)"
                    @keydown.esc="cancelEditItem(item)">

                <span v-else @dblclick="item.edit = true">
                    <del v-if="item.done">{{ item.name }}</del>
                    <span v-else>{{ item.name }}</span>
                </span>
            </li>
        </ul>
    </div>


    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>


    <script>
        const { createApp, ref, reactive, computed, watch, onMounted } = Vue

        createApp({
            setup() {
                const input = ref('')
                const items = reactive([])
                // çœ‹ç›®å‰éæ¿¾çš„æ˜¯èª°
                const filter = ref('å…¨éƒ¨')
                let id = 1

                // æ¡†ç·šé¡è‰²èªè­‰
                const inputBorder = computed(() => {
                    if (input.value.length === 0) {
                        return '3px solid black'
                    } else if (input.value.length < 2) {
                        return '3px solid red'
                    } else {
                        return '3px solid blue'
                    }
                })

                // æ–°å¢é …ç›®
                const addItem = () => {
                    if (input.value.length < 2) return

                    items.push({
                        id: id++,
                        name: input.value,
                        done: false,
                        edit: false,
                        input: input.value
                    })
                    input.value = ''
                }

                // éæ¿¾å·²å®Œæˆã€éæ¿¾æœªå®Œæˆ
                const filteredItems = computed(() => {
                    return items.filter(item => {
                        if (filter.value === 'å…¨éƒ¨') return true
                        // else if (filter.value === 'å·²å®Œæˆ') return item.done === true
                        else if (filter.value === 'å·²å®Œæˆ') return item.done
                        // else return item.done === false
                        // !item.done => æœªå®Œæˆ
                        else return !item.done
                    })
                })

                // æ¨™è¨˜å·²å®Œæˆã€æ¨™è¨˜æœªå®Œæˆ
                const markItems = (value) => {
                    for (const item of items) {
                        item.done = value
                    }
                }

                // æ¸…é™¤å·²å®Œæˆã€æ¸…é™¤æœªå®Œæˆ
                const clearItems = (value) => {
                    const data = items.filter(item => {
                        if (value === 'å…¨éƒ¨') return false
                        else if (value === 'å·²å®Œæˆ') return !item.done
                        else return item.done
                    })
                    items.splice(0, items.length, ...data)
                }

                // ç·¨è¼¯åŠŸèƒ½
                const editItem = (item) => {
                    if (item.input.length < 2) return
                    item.name = item.input
                    item.edit = false
                }

                // æŒ‰ esc å–æ¶ˆç·¨è¼¯
                const cancelEditItem = (item) => {
                    item.input = item.name
                    item.edit = false
                }

                // åˆªé™¤é …ç›®
                const delItem = (id) => {
                    const i = items.findIndex(item => item.id === id)
                    items.splice(i, 1)
                }

                // å¾…è¾¦æ¸…å–®é …ç›®ä¿å­˜åˆ° LocalStorage
                // itemsï¼ˆå¾…è¾¦æ¸…å–®çš„è³‡æ–™ï¼‰ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼ˆä¾‹å¦‚æ–°å¢ã€åˆªé™¤æˆ–ä¿®æ”¹é …ç›®ï¼‰ï¼Œæœƒè§¸ç™¼å›èª¿å‡½å¼
                watch(items, () => {
                    // å›èª¿å‡½å¼å°‡ items çš„è³‡æ–™è½‰æ›ç‚º JSON å­—ä¸²ï¼Œä¸¦å„²å­˜åœ¨ localStorage.vueListNew ä¸­
                    localStorage.vueListNew = JSON.stringify(items)
                })

                // é é¢åŠ è¼‰æ™‚é‚„åŸè³‡æ–™
                onMounted(() => {
                    // localStorage.vueListNew æ˜¯ä¿å­˜çš„è³‡æ–™
                    // å¦‚æœå­˜åœ¨ï¼Œå°±å°‡å…¶è§£ææˆ JavaScript é™£åˆ—ï¼Œå¦å‰‡ä½¿ç”¨ç©ºé™£åˆ—
                    const json = JSON.parse(localStorage.vueListNew || '[]')
                    // å°‡è§£æå‡ºçš„è³‡æ–™æ’å…¥åˆ° items ä¸­ï¼Œé‚„åŸä¹‹å‰çš„æ¸…å–®å…§å®¹
                    items.splice(0, 0, ...json)

                    if (items.length > 0)
                        // è¨­å®š id ç‚ºæœ€å¾Œä¸€å€‹é …ç›®çš„ ID åŠ  1ï¼Œç¢ºä¿æ–°å¢é …ç›®çš„ ID ä¸æœƒé‡è¤‡
                        id = items[items.length - 1].id + 1
                })

                return {
                    input, items, filter, id, inputBorder,
                    addItem, filteredItems, markItems, clearItems,
                    editItem, cancelEditItem, delItem
                }
            }
        })
            .mount('#app')
    </script>
</body>

</html>