<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        /* éŠæˆ²å€åŸŸ */
        #game {
            width: 500px;
            height: 500px;
            background: #000;
            border: 1px solid #000;
            position: relative;
            overflow: hidden;
            /* åœ–ç‰‡ä¸èƒ½å¤ªå¤§ï¼ˆè¶…é 100 or 150 æœƒä¸è¡Œï¼‰ */
            /* åœ–ç‰‡ä½å€ï¼Œæ»‘é¼ xyåº§æ¨™ï¼Œauto */
            cursor: url('./cursor.png') 50 50, auto;
        }

        #game img {
            height: 100px;
            position: absolute;
            /* è¨­å®šç„¡æ³•é¸å–åç™½ */
            user-select: none;
            /* è¨­å®šç„¡æ³•æ‹–æ›³ */
            -webkit-user-drag: none;
        }


        .target {
            /* ä½¿ blood ä¸è¦æ“‹ä½ target */
            z-index: 1;
        }

        .blood {
            pointer-events: none;
            /* ä½¿ blood ä¸è¦æ“‹ä½ target */
            z-index: 0;
        }
    </style>
</head>

<body>
    <input type="button" value="é–‹å§‹" id="btn-start">
    <br>
    <p>åˆ†æ•¸ï¼š<span id="text-score">0</span></p>
    <p>å‰©é¤˜ï¼š<span id="text-time">0</span></p>
    <p>æœ€é«˜åˆ†ç©å®¶ï¼š<span id="text-highscore-player">-</span></p>
    <p>æœ€é«˜åˆ†åˆ†æ•¸ï¼š<span id="text-highscore-score">-</span></p>

    <div id="game"></div>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js'
        integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=='
        crossorigin='anonymous'></script>

    <script>
        // ä¸æˆæ–‡çš„è¨­å®šè¦å®š => ä¸è®Šå‹•çš„ const é€šå¸¸æœƒè¨­å®šç‚ºå…¨å¤§å°
        const GAMETIME = 20
        // åˆ†æ•¸
        let score = 0
        // å‰©é¤˜æ™‚é–“
        let timeleft = 0
        // è¨ˆæ™‚å™¨
        let timer = 0

        // æœ€é«˜åˆ†
        const highscore = {
            name: '-',
            score: 0
        }

        // è®€å– data è³‡æ–™
        // ç©å®¶åå­—ã€æœ€é«˜åˆ†æ•¸ç´€éŒ„
        if (localStorage.fish) {
            const data = JSON.parse(localStorage.fish)
            highscore.name = data.name
            highscore.score = data.score

            $('#text-highscore-player').text(highscore.name)
            $('#text-highscore-score').text(highscore.score)
        }


        $('#btn-start').click(function () {
            // ğŸ”» this æœƒå¾€å¤–å±¤æ‰¾ï¼ŒæŒ‡åˆ°é–‹å§‹æŒ‰éˆ•
            console.log(this)
            // æŒ‰ä¸‹é–‹å§‹å¾Œï¼Œåœç”¨é–‹å§‹æŒ‰éˆ•
            $(this).attr('disabled', true)
            // é‡è¨­
            score = 0
            $('#text-score').text(score)
            timeleft = GAMETIME
            $('#text-time').text(timeleft)

            // ğŸ”» setInterval çš„ function çš„ this æ˜¯ window
            // æ‰€ä»¥å…ˆæŠŠé»æ“Šäº‹ä»¶çš„ this æ”¾åˆ°è®Šæ•¸è£¡é¢çµ¦å¾Œé¢ä½¿ç”¨
            const _this = this

            // é–‹å§‹éŠæˆ²
            timer = setInterval(function () {
                // å€’æ•¸
                timeleft--
                $('#text-time').text(timeleft)

                // å¢åŠ éš¨æ©Ÿæ€§ï¼šéš¨æ©Ÿæ•¸å­—ï¼Œéš¨æ©Ÿ >=5 ä¸”ç›®æ¨™æ•¸é‡ <10ï¼Œæ‰å‡ºç¾
                const random = Math.round(Math.random() * 10)
                if (random >= 5 && $('.target').length < 10) {
                    // éš¨æ©Ÿæ±ºå®šä½ç½®
                    const top = Math.round(Math.random() * 100) + '%'
                    const left = Math.round(Math.random() * 100) + '%'
                    // ç”¢ç”Ÿ
                    const target = $(`<img src="./kodai_sacabambaspis.png" class="target" style="top:${top};left:${left}">`)
                    // ä½¿ target å‡ºç¾åœ¨ #game éŠæˆ²å€
                    $('#game').append(target)
                    // ğŸ”¸ è£½ä½œä¸€å€‹ function ä½¿ target ç§»å‹•
                    move(target)
                }

                // æ™‚é–“åˆ°
                if (timeleft === 0) {
                    clearInterval(timer)
                    // ğŸ”» this å¾€å¤–å±¤æ‰¾æ˜¯ setInterval ï¼ŒæœƒæŒ‡åˆ° windowï¼Œè¦æ³¨æ„
                    console.log(this)
                    $(this).attr('disabled', false)
                    // æ¸…ç©ºéŠæˆ²å€
                    $('#game').empty()

                    if (score > highscore.score) {
                        const name = prompt('æœ€é«˜åˆ†') || 'ã‚ã‚ã‚'
                        highscore.name = name
                        highscore.score = score

                        $('#text-highscore-player').text(highscore.name)
                        $('#text-highscore-score').text(highscore.score)

                        // localStorage.setItem(è³‡æ–™åç¨±, æ–‡å­—)
                        // localStorage.è³‡æ–™åç¨± = æ–‡å­—
                        // .stringify() æŠŠ 'é™£åˆ—ç‰©ä»¶' è½‰æˆ 'æ–‡å­—'
                        // .parse()     æŠŠ 'æ–‡å­—'     è½‰æˆ 'é™£åˆ—ç‰©ä»¶'
                        localStorage.fish = JSON.stringify(highscore)
                    }

                }
            }, 1000)
        })

        // é»æ“Šäº‹ä»¶
        // é»æ“Šäº‹ä»¶è£¡é¢ä¸è¦åŒ…é»æ“Šäº‹ä»¶ï¼Œå› æ­¤å¯«åœ¨å¤–éƒ¨
        // .target æ˜¯å¾Œé¢æ‰ç”¢å‡ºçš„ï¼Œå› æ­¤æ­¤è™•è¦ä½¿ç”¨ #game
        $('#game').on('click', '.target', function () {
            // åœæ­¢å‹•ç•«
            $(this).stop()
            // æ›¿æ›åœ–ç‰‡
            $(this).attr('src', './blood.png')
            // ç§»é™¤ class targetï¼Œæ–°å¢ç‚º class blood
            $(this).removeClass('target').addClass('blood')
            // åˆ†æ•¸æ–°å¢
            score++
            // æ›´æ”¹ç›®å‰åˆ†æ•¸
            $('#text-score').text(score)
        })

        // ğŸ”¸ è£½ä½œä¸€å€‹ function ä½¿ target ç§»å‹•
        function move(target) {
            // éš¨æ©Ÿæ±ºå®šç§»å‹• target ä½ç½®
            const top = Math.round(Math.random() * 100) + '%'
            const left = Math.round(Math.random() * 100) + '%'
            // æ¯å…©ç§’ç§»å‹•ä½ç½®
            target.animate({ top, left }, 2000, function () {
                move(target)
            })
        }
    </script>
</body>

</html>