<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- ğŸ”»çµ„åˆå¼èªæ³• -->
    <div id="app">
        <!-- html éƒ¨åˆ†èˆ‡é¸é …å¼ç›¸åŒ -->
        <form @submit.prevent="addItem">
            <input type="text" v-model="input" :style="{ border: inputBorder }">ã€€
            <input type="submit" value="æ–°å¢">
        </form>

        <hr>

        <input type="text" v-model="search">
        <ul>
            <li v-for="item in filteredItems">
                <input type="checkbox" v-model="item.done">
                <del v-if="item.done">{{ item.text }}</del>
                <span v-else>{{item.text}}</span>ã€€
                <input type="button" value="x" @click="delItem(item.id)">
            </li>
        </ul>

    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        // JavaScript ä¸­çš„è§£æ§‹è³¦å€¼èªæ³•
        // ç”¨æ–¼å¾ Vue.js ä¸­æå– refã€reactiveã€computed ç­‰å‡½å¼
        // onMounted å‰‡æ˜¯ Vue 3 ä¸­çµ„åˆå¼ API æä¾›çš„ç”Ÿå‘½é€±æœŸå‡½æ•¸
        const { ref, reactive, computed, watch, onMounted } = Vue

        Vue.createApp({
            // ğŸ”» çµ„åˆèªæ³•ä½¿ç”¨ setup
            setup() {
                // å…ˆå€åˆ† ref or reactive
                //1ï¸âƒ£ ref: æ‰€æœ‰è³‡æ–™å‹æ…‹éƒ½èƒ½ä½¿ç”¨ï¼Œä½¿ç”¨æ™‚åŠ  .valueï¼Œä¸æœƒæ·±å±¤ç›£è½ç‰©ä»¶é™£åˆ—
                const input = ref('')
                const search = ref('')
                //2ï¸âƒ£ reactive: åªæœ‰é™£åˆ—ç‰©ä»¶å¯ä»¥ç”¨ï¼Œä¸ç”¨åŠ  .valueï¼Œå¯ä»¥æ·±å±¤ç›£è½ç‰©ä»¶é™£åˆ—
                const items = reactive([])
                // è‹¥ä¸Šæ–¹ html ä¸æœƒç”¨åˆ° => å°±ä¸éœ€è¦éŸ¿æ‡‰å¼
                let id = 1

                // å®£å¸ƒä¸€å€‹è®Šæ•¸(inputBorder) = computed
                const inputBorder = computed(() => {
                    if (input.value.length === 0) {
                        return ''
                    } else if (input.value.length < 3) {
                        return '5px solid red'
                    } else {
                        return '5px solid green'
                    }
                })

                const addItem = () => {
                    if (input.value.length < 3) return

                    items.push({
                        text: input.value,
                        done: false,
                        id: id++
                    })
                    input.value = ''
                }

                const filteredItems = computed(() => {
                    return items.filter(item => {
                        return item.text.includes(search.value)
                    })
                })

                const delItem = (id) => {
                    const i = items.findIndex(item => {
                        return item.id === id
                    })
                    items.splice(i, 1)
                }

                // watchã€onMounted ä¸éœ€è¦ return
                // åµæ¸¬è®Šæ›´
                watch(items, () => {
                    localStorage.vueList = JSON.stringify(items)
                })

                // onMounted æ˜¯ Vue 3 ä¸­çµ„åˆå¼ API æä¾›çš„ç”Ÿå‘½é€±æœŸå‡½æ•¸
                // æœƒåœ¨çµ„ä»¶çš„ DOM å·²å®Œæˆåˆå§‹æ¸²æŸ“å¾ŒåŸ·è¡Œ
                // é©åˆç”¨æ–¼éœ€è¦æ“ä½œ DOM æˆ–åŸ·è¡Œåªéœ€åœ¨çµ„ä»¶è¼‰å…¥æ™‚é‹è¡Œçš„ç¨‹å¼ç¢¼ï¼Œä¾‹å¦‚ API è«‹æ±‚ã€äº‹ä»¶ç›£è½å™¨çš„ç¶å®šæˆ–åˆå§‹åŒ–è³‡æ–™
                onMounted(() => {
                    // è®€å– localStorage.vueList çš„æ–‡å­—è§£ææˆ JSON
                    const json = JSON.parse(localStorage.vueList || '[]')
                    console.log(json)

                    // å¾é™£åˆ—ç¬¬ 0 å€‹é–‹å§‹ã€åˆªé™¤ 0 é …ã€...åŠ å…¥è§£æå®Œçš„æ±è¥¿ (ä¸Šåˆ—çš„ json)
                    items.splice(0, 0, ...json)

                    // items[items.length - 1] å–å¾—é™£åˆ—ä¸­çš„æœ€å¾Œä¸€å€‹é …ç›®ã€‚
                    // items[items.length - 1].id å–å¾—æœ€å¾Œä¸€å€‹é …ç›®çš„ IDã€‚
                    // + 1 è¡¨ç¤ºå°‡ id è¨­å®šç‚ºæœ€å¾Œä¸€å€‹é …ç›®çš„ ID åŠ  1ï¼Œç¢ºä¿æ–°åŠ å…¥çš„é …ç›®æœ‰å”¯ä¸€çš„ IDã€‚
                    if (items.length > 0) {
                        id = items[items.length - 1].id + 1
                    }
                })

                // ğŸ”»å®¹æ˜“å¿˜è¨˜ï¼Œè¨˜å¾—è¦æŠŠ html æœƒç”¨åˆ°çš„ return å‡ºå»
                return {
                    input, search, inputBorder, addItem, filteredItems, delItem
                }
            }
        }).mount('#app')
    </script>
</body>

</html>